"use strict";

var parse = require("minimist");
var get = require("lodash.get");
var nba = require("./");

run(parse(process.argv.slice(2)));

function run(args) {
  // console.log(args);

  if (args.ls) {
    console.log("available methods:");
    ["stats", "sportVu", "synergy"].forEach(function (namespace) {
      Object.keys(nba[namespace]).forEach(function (method) {
        if (method === "withTransport") return;
        console.log(namespace + "." + method);
      });
    });
    return;
  }

  var method = args.method;

  if (!method) throw new Error("Need a `method`");

  var fn = get(nba, method);

  if (fn == null) throw new Error("No function at " + method);

  if (args.docs) {
    if (fn.defaults) {
      console.log(method + " default parameters:");
      Object.keys(fn.defaults).forEach(function (key) {
        console.log("â€¢ " + key + ": " + fn.defaults[key]);
      });
    }
    return;
  }

  delete args._;
  delete args.method;

  fn(args).then(function (obj) {
    console.log(JSON.stringify(obj));
  });
}